## 工作原理

### 进程和线程

#### 线程

不能单独存在，它由进程来启动和管理 

##### 多线程&单线程

- 并行处理

  多线程可以并行处理任务（比如一起处理计算任务，先处理完的进程再执行别的任务），大大提升性能

  单线程只能一个一个任务按顺序处理

- 线程之间是可以**共享数据**的

  进程作为分配资源的基本单位，线程作为独立运行和独立调度的基本单位。

  地址空间和资源： 进程之间相互独立 VS 各线程之间共享

- 进程中的任意一个**线程执行出错**，都会导致整个进程崩溃

  （进程崩溃不会影响别的进程）

- 当一个进程关闭之后，操作系统会**回收**进程所占用的**内存**

#### 进程

一个进程就是一个程序的运行实例，操作系统为一个程序创建一块内存，用来存放代码、运行的数据和一个执行任务的主线程，这样的一个运行环境叫进程

- 进程之间的是相互隔离的（**一般情况下**,需要的话进程之间也可以通信）
- 进程之间的通信机制（IPC）

### 浏览器进程架构的演化

#### 单进程浏览器 

1. 不稳定

   线程崩溃，整个进程也会全部崩掉。

   在单进程架构的浏览器里，我们的页面渲染引擎、插件程序，还有像IE里有很多动态链接库的程序都是可能出错的❌，那么不管这些程序在进程中的哪个线程里面运行，其实只要有一个出了个错，那么整个浏览器就挂掉了。这就是我们说的**不稳定**。（只有一个进程）

2. 不流畅

   CPU在某个时间点只能执行某个进程中的某一条线程。当我们一个页面线程中既包含了页面的渲染又包含了JS的执行，还有各种插件执行的时候，如果页面线程的某个任务发生问题，则当别的线程把CPU抢走的时候，容易阻塞发生卡顿。

3. 不安全

   线程共享进程资源

   恶意插件能获取到浏览器运行过程中的数据，以及拥有和浏览器同等的系统权限。容易导致隐私泄露，遭到垃圾信息的攻击

#### 多进程浏览器

1. 解决不稳定

   进程是相互隔离的，当某个页面的插件进程中出了问题，也只是该页面受到影响，渲染进程不受到影响

2. 解决不流畅

   js也是运行在渲染进程中的，所以即使js阻塞渲染进程，影响的也只是当前页面

3. 解决不安全

   把插件进程和渲染进程锁在操作系统的安全沙箱里面运行，沙箱里的程序是不能读写硬盘的数据的

#### 目前的浏览器

一个主进程 + 一个GPU进程 + 一个网络进程 + 多个渲染进程 + 多个插件进程

1. **浏览器主进程**。整个浏览器的主要进程，其他几个进程都是这个进程的子进程，由它来管理和调配；同时你所看到的浏览器的整个窗口，包含地址输入栏，书签栏这些东西也都是它来展示的；

2. **渲染进程**。把HTML,CSS,JS转换成页面。一般来说一个Tab标签页面一个渲染进程（对于不一般的情况可以了解Site Isolation策略）；每个渲染进程中会运行Blink布局引擎，V8 JavaScript执行引擎等，单独服务于一个Tab标签页；运行在沙盒中无法访问系统资源。

3. **插件进程**。一个插件单独存在于一个进程当中，同时为了安全性，运行在沙盒中限制其权限。

4. **网络进程**。发起网络请求访问，加载网络资源。

5. **GPU进程**。绘制复杂的动画UI界面（比如3D动画），处理GPU渲染方面的任务。

   作者：罗辑思维前端开发团队
   链接：https://juejin.cn/post/6844904019131891725
   来源：掘金
   著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。

6. 最近：存储进程（storage），音频视频播放进程（audio）

#### 面向服务的架构

高内聚，低耦合，易维护，易扩展

### 浏览器中的网络流程

### 页面渲染的流程

### JS执行的流程

### Web安全

### 